<%init>
use lib '/var/www/html/lib';
use CGI qw(:standard cookie);
use AppLib qw(send_email get_user_by_session);

my $q = CGI->new;
my $session_cookie = $q->cookie('SESSION') || '';
my $user = get_user_by_session($session_cookie);
my $success = '';
my $error = '';

if ($q->request_method eq 'POST') {
    my $name = $q->param('name') || '';
    my $email = $q->param('email') || '';
    my $message = $q->param('message') || '';
    
    if ($name && $email && $message) {
        # Email to your address
        my $to = 'dobreavlad@yahoo.com';
        my $subject = "Contact Form: Message from $name";
        my $body = "Name: $name\n";
        $body .= "Email: $email\n";
        $body .= "Message:\n$message\n";
        
        my ($ok, $err) = send_email($to, $subject, $body);
        
        if ($ok) {
            $success = 'Thanks for reaching out. We will get back to you soon.';
        } else {
            $error = 'There was an error sending your message. Please try again later.';
        }
    } else {
        $error = 'All fields are required.';
    }
}
</%init>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact - PropertySite</title>
  <link rel="stylesheet" href="/public/css/styles.css">
</head>
<body>
<% $m->comp('/includes/header.html', user => $user, current => 'contact') %>

<div class="auth-container">
  <h1>Contact Us</h1>
% if ($success) {
  <div class="success"><% $success %></div>
% }
% if ($error) {
  <div class="error"><% $error %></div>
% }
  <form method="post" action="/contact/">
    <div class="form-group">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" required>
    </div>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" required>
    </div>
    <div class="form-group">
      <label for="message">Message</label>
      <textarea id="message" name="message" rows="6" required></textarea>
    </div>
    <button type="submit">Send Message</button>
  </form>
</div>

<% $m->comp('/includes/footer.html') %>
</body>
</html>
