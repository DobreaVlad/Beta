ServerName localhost

<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /var/www/mason

    PerlModule HTML::Mason::ApacheHandler

    <Location />
        SetHandler perl-script
        PerlResponseHandler HTML::Mason::ApacheHandler
    </Location>

    <Directory /var/www/mason>
        Options +ExecCGI
        AllowOverride None
        Require all granted
        DirectoryIndex index.html
    </Directory>
    
    PerlSetVar MasonCompRoot /var/www/mason
    PerlSetVar MasonDataDir /tmp/mason_data

    # Pass DB/SMTP environment variables to mod_perl
    PassEnv MYSQL_URL
    PassEnv MYSQL_PUBLIC_URL
    PassEnv DATABASE_URL
    PassEnv MYSQLHOST
    PassEnv MYSQLDATABASE
    PassEnv MYSQLUSER
    PassEnv MYSQLPASSWORD
    PassEnv MYSQLPORT
    PassEnv DB_HOST
    PassEnv DB_NAME
    PassEnv DB_USER
    PassEnv DB_PASS
    PassEnv SMTP_HOST
    PassEnv SMTP_PORT
    PassEnv SMTP_FROM
    PassEnv APP_ENV
    
    # Pass Stripe environment variables to mod_perl
    PassEnv STRIPE_SECRET_KEY
    PassEnv STRIPE_PUBLISHABLE_KEY
    PassEnv STRIPE_WEBHOOK_SECRET
    PassEnv APP_BASE_URL
    
    # Disable Mason caching in dev
    # Mason cache settings handled by MasonDataDir (manual cache clear in dev)
    
    # Don't process static files with Mason
    <LocationMatch "\.(css|js|jpg|jpeg|png|gif|ico)$">
        SetHandler default-handler
    </LocationMatch>

    # Serve static files directly
    Alias /public /var/www/html/public
    <Directory /var/www/html/public>
        SetHandler default-handler
        Require all granted
    </Directory>

    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 common
</VirtualHost>
